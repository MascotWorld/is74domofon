# IS74 –î–æ–º–æ—Ñ–æ–Ω - Home Assistant Integration

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-orange.svg)](https://github.com/hacs/integration)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–æ—Ñ–æ–Ω–æ–º IS74 (–ò–°74, –ò–Ω—Ç–µ—Ä—Å–≤—è–∑—å) —á–µ—Ä–µ–∑ Home Assistant.

## üè† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üö™ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–µ—Ä—å—é** - –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏ –∏–∑ Home Assistant
- üìπ **–ö–∞–º–µ—Ä—ã** - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä –¥–æ–º–æ—Ñ–æ–Ω–∞
- üîî **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–∞—Ö —á–µ—Ä–µ–∑ FCM
- ü§ñ **–ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- üì¶ **–†–µ–∂–∏–º –∫—É—Ä—å–µ—Ä–∞** - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∞–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
- üåê **–í–µ–±-–ø–∞–Ω–µ–ª—å** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ß–µ—Ä–µ–∑ HACS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ HACS –≤ Home Assistant
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç—Ä–∏ —Ç–æ—á–∫–∏ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
4. –í—ã–±–µ—Ä–∏—Ç–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏"
5. –î–æ–±–∞–≤—å—Ç–µ URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `https://github.com/your-username/is74domofon`
6. –ö–∞—Ç–µ–≥–æ—Ä–∏—è: Integration
7. –ù–∞–π–¥–∏—Ç–µ "IS74 –î–æ–º–æ—Ñ–æ–Ω" –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
8. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Home Assistant

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ HACS ‚Üí Frontend
2. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π (–∫–∞—Ç–µ–≥–æ—Ä–∏—è: Lovelace)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ "IS74 Domofon Card"
4. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ—Å—É—Ä—Å –≤ Lovelace:

```yaml
resources:
  - url: /hacsfiles/is74-domofon-card/is74-domofon-card.js
    type: module
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ IS74 Integration Service:

```bash
cd is74domofon
python run_api.py
```

2. –ü—Ä–æ–π–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ API –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–ª—É–∂–±—ã
2. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é"
3. –ù–∞–π–¥–∏—Ç–µ "IS74 –î–æ–º–æ—Ñ–æ–Ω"
4. –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ API —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:8000`)

## üé® Lovelace –∫–∞—Ä—Ç–æ—á–∫–∞

### –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
type: custom:is74-domofon-card
title: –ú–æ–π –¥–æ–º–æ—Ñ–æ–Ω
api_url: http://192.168.1.100:8000
entities:
  device_sensor: sensor.is74_domofon_status
  service_sensor: sensor.is74_service_status
  fcm_sensor: sensor.is74_fcm_push
  open_button: button.is74_open_door
  reject_button: button.is74_reject_call
  auto_open_switch: switch.is74_auto_open
  courier_switch: switch.is74_courier
  fcm_switch: switch.is74_fcm
  cameras:
    - camera.is74_camera_entrance
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ—Å—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (YAML)

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏:

```yaml
type: vertical-stack
cards:
  - type: entities
    entities:
      - entity: sensor.is74_domofon_status
        name: –î–æ–º–æ—Ñ–æ–Ω
        secondary_info: last-changed
      - entity: switch.is74_auto_open
        name: –ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ
  - type: horizontal-stack
    cards:
      - type: tile
        entity: button.is74_open_door
        name: –û—Ç–∫—Ä—ã—Ç—å
        color: green
        tap_action:
          action: call-service
          service: button.press
          target:
            entity_id: button.is74_open_door
      - type: tile
        entity: switch.is74_courier
        name: –ö—É—Ä—å–µ—Ä
        color: blue
      - type: tile
        entity: button.is74_reject_call
        name: –°–±—Ä–æ—Å
        color: red
```

## üîß –°–µ—Ä–≤–∏—Å—ã

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

| –°–µ—Ä–≤–∏—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `is74_domofon.open_door` | –û—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å |
| `is74_domofon.toggle_auto_open` | –í–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ |
| `is74_domofon.start_fcm` | –ó–∞–ø—É—Å—Ç–∏—Ç—å Push —Å–µ—Ä–≤–∏—Å |
| `is74_domofon.stop_fcm` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Push —Å–µ—Ä–≤–∏—Å |

### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

```yaml
automation:
  - alias: "–ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏"
    trigger:
      platform: time
      at: "09:00:00"
    condition:
      condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
      service: is74_domofon.toggle_auto_open
      data:
        enabled: true

  - alias: "–í—ã–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏—è –≤–µ—á–µ—Ä–æ–º"
    trigger:
      platform: time
      at: "18:00:00"
    action:
      service: is74_domofon.toggle_auto_open
      data:
        enabled: false
```

## üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–≤–æ–Ω–∫–∞—Ö –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é:

```yaml
automation:
  - alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–≤–æ–Ω–∫–µ –≤ –¥–æ–º–æ—Ñ–æ–Ω"
    trigger:
      platform: event
      event_type: is74_domofon_incoming_call
    action:
      service: notify.mobile_app_your_phone
      data:
        title: "üö™ –ó–≤–æ–Ω–æ–∫ –≤ –¥–æ–º–æ—Ñ–æ–Ω"
        message: "–ö—Ç–æ-—Ç–æ –∑–≤–æ–Ω–∏—Ç –≤ –¥–≤–µ—Ä—å"
        data:
          actions:
            - action: OPEN_DOOR
              title: "–û—Ç–∫—Ä—ã—Ç—å"
            - action: REJECT_CALL
              title: "–û—Ç–∫–ª–æ–Ω–∏—Ç—å"
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å–µ—Ä–≤–µ—Ä

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ IS74 Integration Service –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ Home Assistant
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f ~/.homeassistant/home-assistant.log | grep is74`

### –ö–∞–º–µ—Ä—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ IS74
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–º–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ API (`GET /cameras`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å CDN –∫–∞–º–µ—Ä

### Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ FCM: `POST /fcm/init`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Push —Å–µ—Ä–≤–∏—Å: `POST /fcm/start`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `GET /fcm/status`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –í–∫–ª–∞–¥

Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ issue.

